<!--
Figure 16. STM32F40x memory map in DM00037051.pdf
Bigbanding
and from DM00037051.pdf Table 9.STM32F40x register boundary addresses.

The datasheet is messy about how it names various areas and busses. For
example the AHB1 bus has two peripheral bridges and various directly
connected peripherals. The datasheet, registers and other documentation 
(mostly) start the 'AHB1' bus *after* the two peripheral bridges, with
offsets of zero; when, in fact, the bridges sit first and other directly
attached peripherals should be numbers above them. Also the ethernet and
ADC devices are better described as a bridge first.

To fix this I added a layer to the memory hierarchy called 'Bus1', 'Bus2' etc,
from which the APBx AHB1 Eth and ADC are bridged.

When organized like this the offset block number (sector) lines up precisely
with the enable register bit locations; giving me some confidence that this
organization more closely resembles how ST designed the underlying structure
of the chip. Could be wrong though!!
-->

<memory-overview chip="stm32f407vg">
  <block name="Root" offset="0x00000000" size="4Gb">
    <block name="Block0"   offset="0x00000000" size="512Mb" >
      <block name="Boot"     offset="0x00000000" />
      <block name="Flash"    offset="0x08000000" />
      <block name="CCM"      offset="0x10000000" />
      <block name="Sys"      offset="0x1fff0000" />
      <block name="Opt"      offset="0x1fffc000" />
    </block>
    <block name="Block1"   offset="0x20000000" size="512Mb" >
      <block name="SRAM"     offset="0x0000000" bb="0x02000000" size="1Mb">
        <block name="SRAM1"    offset="0x00000000" />
        <block name="SRAM2"    offset="0x0001c000" />
        <block name="SRAM3"    offset="0x00020000" />
      </block>
    </block>
    <block name="Block2"   offset="0x40000000" size="512Mb" >
      <block name="Bus1"     offset="0x00000000" bb="0x02000000" size="1Mb" width="64kb" >
        <block name="APB1"     offset="0x00000000" size="64kb" width="1kb" />
        <block name="APB2"     offset="0x00010000" size="64kb" width="1kb"/>
        <block name="AHB1"     offset="0x00020000" size="896kb" width="1kb" >
          <block name="SRAM1_R"   offset="0x4000" size="1kb" class="CR"/>
          <block name="SRAM2_R"   offset="0x4400" size="1kb" class="CR"/>
          <block name="BKPSRAM_R" offset="0x4800" size="1kb" class="CR"/>
          <block name="SRAM3_R"   offset="0x4c00" size="1kb" class="CR"/>
          <block name="CCM_R"     offset="0x5000" size="1kb" class="CR"/>
        </block>
      </block>
      <block name="Bus2"     offset="0x10000000" size="256Mb">
        <block name="AHB2"     offset="0x00000000" size="256Mb"/>
      </block>
    </block>
    <block name="Block345" offset="0x60000000" size="1536Mb" >
      <block name="Bus3"     offset="0x00000000" size="1536Mb" >
        <block name="AHB3"     offset="0x00000000" size="1536Mb"/>
      </block>
    </block>
    <block name="Block6"   offset="0xc0000000" size="512Mb" />
    <block name="Block7"   offset="0xe0000000" size="512Mb" >
      <block name="CortexM4" offset="0x00000000" size="512Mb" />
    </block>
  </block>
</memory-overview>

